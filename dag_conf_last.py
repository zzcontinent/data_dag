# !/usr/bin/env python
# -*- coding: utf-8 -*-
import sys

reload(sys)
sys.setdefaultencoding('utf-8')

NODES = [

 {'nodes': {1: {'color': 'lightblue', 'name': 'SQL', 'desc': '\n    INSERT INTO transit_jff.direct_store_name_list_sum(sp_id, league_id, league_name, ent_id, ent_short_name, sp_ent_id, sum_wage_min, sum_wage_max, intv_cnt)\nSELECT a.sp_id,\n       b.league_id,\n       b.league_name,\n       d.ent_id,\n       d.ent_short_name,\n       a.sp_ent_id,\n       d.sum_wage_min,\n       d.sum_wage_max,\n       count(1) AS intv_cnt\nFROM ods_jff.name_list a\nLEFT JOIN ods_jff.league_store b ON a.sp_id = b.sp_id\nLEFT JOIN ods_jff.sp_ent c ON a.sp_ent_id = c.sp_ent_id\nLEFT JOIN ods_jff.ent d ON c.ent_id = d.ent_id\nWHERE a.is_deleted = 0 -- and b.coop_mode = 3\nAND b.is_deleted = 0\n  AND d.ent_id > 0\n  AND a.intv_dt >= date_sub(current_date(), interval 1 MONTH)\nGROUP BY a.sp_id,\n         b.league_id,\n         b.league_name,\n         d.ent_id,\n         d.ent_short_name,\n         a.sp_ent_id,\n         d.sum_wage_min,\n         d.sum_wage_max;\n    '}, 2: {'color': 'blue', 'name': u'ods_jff.name_list', 'desc': '\xe8\xa1\xa8'}, 3: {'color': 'blue', 'name': u'ods_jff.league_store', 'desc': '\xe8\xa1\xa8'}, 4: {'color': 'blue', 'name': u'ods_jff.sp_ent', 'desc': '\xe8\xa1\xa8'}, 5: {'color': 'blue', 'name': u'ods_jff.ent', 'desc': '\xe8\xa1\xa8'}, 6: {'color': 'orange', 'name': u'sum_wage_max', 'desc': '\xe5\xad\x97\xe6\xae\xb5'}, 7: {'color': 'orange', 'name': u'league_id', 'desc': '\xe5\xad\x97\xe6\xae\xb5'}, 8: {'color': 'orange', 'name': u'sum_wage_min', 'desc': '\xe5\xad\x97\xe6\xae\xb5'}, 9: {'color': 'orange', 'name': u'ent_short_name', 'desc': '\xe5\xad\x97\xe6\xae\xb5'}, 10: {'color': 'orange', 'name': u'sp_id', 'desc': '\xe5\xad\x97\xe6\xae\xb5'}, 11: {'color': 'orange', 'name': '#meta2', 'desc': u'\u5b57\u6bb5 | count ( 1 ) '}, 12: {'color': 'orange', 'name': u'sp_ent_id', 'desc': '\xe5\xad\x97\xe6\xae\xb5'}, 'ts': {'color': 'red', 'name': '\xe5\xbc\x80\xe5\xa7\x8b', 'desc': '\xe5\xbc\x80\xe5\xa7\x8b'}, 14: {'color': 'orange', 'name': u'league_name', 'desc': '\xe5\xad\x97\xe6\xae\xb5'}, 13: {'color': 'orange', 'name': u'ent_id', 'desc': '\xe5\xad\x97\xe6\xae\xb5'}, 15: {'color': 'pink', 'name': u'intv_cnt', 'desc': '\xe5\xad\x97\xe6\xae\xb5\xe5\x88\xab\xe5\x90\x8d'}}, 'dag': 'ts >> 1 \n11 >> 15\n5 >> 6\n3 >> 7\n5 >> 8\n5 >> 9\n2 >> 10\n1 >> 11\n2 >> 12\n5 >> 13\n3 >> 14\n1 >> 5\n1 >> 3\n1 >> 2\n1 >> 4', 'title': 'jff_online_service\xe4\xb8\xad\xe4\xb8\x80\xe4\xb8\xaa\xe6\xa1\x88\xe4\xbe\x8b'},
 {'nodes': {1: {'color': 'lightblue', 'name': 'SQL', 'desc': "\n        SELECT user_sk, count(distinct (intv_dt_sk, ent_sk)) as intv_cnt, \nround(count(distinct (case when intv_sts=2 then (intv_dt_sk, ent_sk) else null end))/(count(distinct (intv_dt_sk, ent_sk))+0),2) as intv_sccs_rt, \nround(count(distinct (case when fdbk_sts=2 then (intv_dt_sk, ent_sk) else null end))/(count(distinct (intv_dt_sk, ent_sk))+0),2) as hr_rt,\ncase when count(fdbk_sts=2 or null)=0 then count(distinct (intv_dt_sk, ent_sk)) else\nround((count(distinct (intv_dt_sk, ent_sk))+0.0)/count(distinct (case when fdbk_sts=2 then (intv_dt_sk, ent_sk) else null end))) end as hr_per_intv_cnt\n, max(event_tm) as max_intv_dt, min(event_tm) as min_intv_dt,\ndate_part('day', CURRENT_TIMESTAMP-min(event_tm))+1 as intv_dys,\nround(count(distinct (intv_dt_sk, ent_sk))/(date_part('year', CURRENT_TIMESTAMP-min(event_tm))+1)::numeric,2) as intv_frq,\nround(count(distinct (case when is_inner<2 then (intv_dt_sk, ent_sk) else null end))/count(distinct (intv_dt_sk, ent_sk))::numeric,2) as zxx_intv_rt,\nmin(case when is_inner<2 then event_tm else CURRENT_DATE end) as first_intv_zxx_tm\nFROM dm.fact_interview\nwhere is_deleted=0 and user_sk!=''\ngroup by user_sk"}, 2: {'color': 'blue', 'name': u'dm.fact_interview', 'desc': '\xe8\xa1\xa8'}, 3: {'color': 'orange', 'name': '#meta44', 'desc': u'\u5b57\u6bb5 | CASE WHEN count ( fdbk_sts = 2 OR NULL ) = 0 THEN count ( ( intv_dt_sk ent_sk ) ) ELSE round ( ( count ( ( intv_dt_sk ent_sk ) ) + 0.0 ) / count ( ( CASE WHEN fdbk_sts = 2 THEN ( intv_dt_sk ent_sk ) ELSE NULL END ) ) ) END '}, 4: {'color': 'orange', 'name': '#meta43', 'desc': u'\u5b57\u6bb5 | min ( CASE WHEN is_inner<2 THEN event_tm ELSE CURRENT_DATE END ) '}, 5: {'color': 'orange', 'name': '#meta42', 'desc': u'\u5b57\u6bb5 | round ( count ( ( CASE WHEN is_inner<2 THEN ( intv_dt_sk ent_sk ) ELSE NULL END ) ) / count ( ( intv_dt_sk ent_sk ) ) :: numeric 2 ) '}, 6: {'color': 'orange', 'name': u'user_sk', 'desc': '\xe5\xad\x97\xe6\xae\xb5'}, 7: {'color': 'orange', 'name': '#meta27', 'desc': u'\u5b57\u6bb5 | max ( event_tm ) '}, 8: {'color': 'orange', 'name': '#meta16', 'desc': u'\u5b57\u6bb5 | round ( count ( ( CASE WHEN fdbk_sts = 2 THEN ( intv_dt_sk ent_sk ) ELSE NULL END ) ) / ( count ( ( intv_dt_sk ent_sk ) ) + 0 ) 2 ) '}, 9: {'color': 'orange', 'name': '#meta2', 'desc': u'\u5b57\u6bb5 | count ( ( intv_dt_sk ent_sk ) ) '}, 10: {'color': 'orange', 'name': '#meta30', 'desc': u"\u5b57\u6bb5 | date_part ( 'day' CURRENT_TIMESTAMP - min ( event_tm ) ) + 1 "}, 11: {'color': 'orange', 'name': '#meta36', 'desc': u"\u5b57\u6bb5 | round ( count ( ( intv_dt_sk ent_sk ) ) / ( date_part ( 'year' CURRENT_TIMESTAMP - min ( event_tm ) ) + 1 ) :: numeric 2 ) "}, 12: {'color': 'orange', 'name': '#meta9', 'desc': u'\u5b57\u6bb5 | round ( count ( ( CASE WHEN intv_sts = 2 THEN ( intv_dt_sk ent_sk ) ELSE NULL END ) ) / ( count ( ( intv_dt_sk ent_sk ) ) + 0 ) 2 ) '}, 13: {'color': 'orange', 'name': '#meta28', 'desc': u'\u5b57\u6bb5 | min ( event_tm ) '}, 14: {'color': 'pink', 'name': u'hr_per_intv_cnt', 'desc': '\xe5\xad\x97\xe6\xae\xb5\xe5\x88\xab\xe5\x90\x8d'}, 15: {'color': 'pink', 'name': u'first_intv_zxx_tm', 'desc': '\xe5\xad\x97\xe6\xae\xb5\xe5\x88\xab\xe5\x90\x8d'}, 16: {'color': 'pink', 'name': u'zxx_intv_rt', 'desc': '\xe5\xad\x97\xe6\xae\xb5\xe5\x88\xab\xe5\x90\x8d'}, 17: {'color': 'pink', 'name': u'max_intv_dt', 'desc': '\xe5\xad\x97\xe6\xae\xb5\xe5\x88\xab\xe5\x90\x8d'}, 18: {'color': 'pink', 'name': u'hr_rt', 'desc': '\xe5\xad\x97\xe6\xae\xb5\xe5\x88\xab\xe5\x90\x8d'}, 19: {'color': 'pink', 'name': u'intv_cnt', 'desc': '\xe5\xad\x97\xe6\xae\xb5\xe5\x88\xab\xe5\x90\x8d'}, 20: {'color': 'pink', 'name': u'intv_dys', 'desc': '\xe5\xad\x97\xe6\xae\xb5\xe5\x88\xab\xe5\x90\x8d'}, 21: {'color': 'pink', 'name': u'intv_frq', 'desc': '\xe5\xad\x97\xe6\xae\xb5\xe5\x88\xab\xe5\x90\x8d'}, 22: {'color': 'pink', 'name': u'intv_sccs_rt', 'desc': '\xe5\xad\x97\xe6\xae\xb5\xe5\x88\xab\xe5\x90\x8d'}, 23: {'color': 'pink', 'name': u'min_intv_dt', 'desc': '\xe5\xad\x97\xe6\xae\xb5\xe5\x88\xab\xe5\x90\x8d'}, 'ts': {'color': 'red', 'name': '\xe5\xbc\x80\xe5\xa7\x8b', 'desc': '\xe5\xbc\x80\xe5\xa7\x8b'}}, 'dag': 'ts >> 1 \n3 >> 14\n4 >> 15\n5 >> 16\n7 >> 17\n8 >> 18\n9 >> 19\n10 >> 20\n11 >> 21\n12 >> 22\n13 >> 23\n2 >> 3\n2 >> 4\n2 >> 5\n2 >> 6\n2 >> 7\n2 >> 8\n2 >> 9\n2 >> 10\n2 >> 11\n2 >> 12\n2 >> 13\n1 >> 2', 'title': '\xe5\x91\xa8\xe9\x91\xab\xe6\xa1\x88\xe4\xbe\x8b1'},]
