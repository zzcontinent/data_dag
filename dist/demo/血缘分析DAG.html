<!doctype html>

<meta charset="utf-8">
<title>血缘分析DAG</title>

<link rel="stylesheet" href="demo.css">
<script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
<script src="./dagre-d3.js"></script>

<!-- Pull in JQuery dependencies -->
<link rel="stylesheet" href="tipsy.css">
<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="tipsy.js"></script>

<style id="css">
  text {
    font-weight: 300;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serf;
    font-size: 14px;
  }

  .node rect {
    stroke: #333;
    fill: #fff;
  }

  .edgePath path {
    stroke: #333;
    fill: #333;
    stroke-width: 1.5px;
  }

  .node text {
    pointer-events: none;
  }

  /* This styles the title of the tooltip */
  .tipsy .name {
    font-size: 1.5em;
    font-weight: bold;
    color: #60b1fc;
    margin: 0;
  }

  /* This styles the body of the tooltip */
  .tipsy .description {
    font-size: 1.2em;
  }

</style>

<h3>ods_wait_trigger</h3>
<svg width=960 height=800 id="svg1"></svg>
<script>
  var highlight_color = "#000000";
  var upstream_color = "#0000FF";
  var downstream_color = "#0000FF"
  var fill_default_color = "rgb(240, 237, 228)"
  var fill_upstream_color = "orange"
  var fill_downstream_color = "orange"
  var initialStrokeWidth = '3px';
  
  // Create a new directed graph
  var g1 = new dagreD3.graphlib.Graph().setGraph({});

  // States and transitions from RFC 793
  var states = {
    "wd_subsidy": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/wd_subsidy/wd_subsidy.kjb",
    style: "fill: orange"
  },
  "wd_interaction": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/wd_interaction/wd_interaction.kjb",
    style: "fill: orange"
  },
  "zhouxin_jff1_sp_credict": {
    description: "ssh 192.168.10.29 < /datas/airflow/dags/zhouxin_jff1_sp_credict.cmd ",
    style: "fill: orange"
  },
  "financial": {
    description: "source /home/datas/financial/cmd_day",
    style: "fill: orange"
  },
  "wd_recruit_demand": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/wd_recruit_demand/wd_recruit_demand.kjb",
    style: "fill: orange"
  },
  "wait_until_success_ods_jff": {
    description: "/home/datas/.virtualenvs/env27/bin/python /home/datas/ods_controller/ods_controller_jff/task5_wait_until_success.py",
    style: "fill: green"
  },
  "zhouxin_woda2_cheat_detect": {
    description: "ssh 192.168.10.29 < /datas/airflow/dags/zhouxin_woda2_cheat_detect.cmd ",
    style: "fill: orange"
  },
  "zhouxin_operator_data": {
    description: "ssh 192.168.10.29 < /datas/airflow/dags/zhouxin_operator_data.cmd ",
    style: "fill: orange"
  },
  "wd_hire": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/wd_hire/wd_hire.kjb",
    style: "fill: orange"
  },
  "dim_broker_cliff": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/dim_broker/broker/broker.kjb",
    style: "fill: orange"
  },
  "zhouxin_woda1_user_exam_result_server_all_total": {
    description: "ssh 192.168.10.29 < /datas/airflow/dags/zhouxin_woda1_user_exam_result_server_all_total.cmd ",
    style: "fill: orange"
  },
  "wd_preorder": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/wd_preorder/wd_preorder.kjb",
    style: "fill: orange"
  },
  "wait_until_success_ods_zxx": {
    description: "/home/datas/.virtualenvs/env27/bin/python /home/datas/ods_controller/ods_controller_zxx/task5_wait_until_success.py",
    style: "fill: green"
  },
  "zhouxin_etl_service_cb_operation_data": {
    description: "ssh 192.168.10.29 < /datas/airflow/dags/zhouxin_jff_etl_service_cb_operation_data.cmd ",
    style: "fill: orange"
  },
  "zhouxin_name_list_analysis": {
    description: "ssh 192.168.10.29 < /datas/airflow/dags/zhouxin_name_list_analysis.cmd ",
    style: "fill: orange"
  },
  "load_dim": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/load_dim/load_dim_job.kjb",
    style: "fill: orange"
  },
  "zhouxin_woda3_recommend": {
    description: "ssh 192.168.10.29 < /datas/airflow/dags/zhouxin_woda3_recommend.cmd ",
    style: "fill: orange"
  },
  "interface_v2_daily_job_reguser_channel_operation": {
    description: "source /home/datas/interface_v2/cmd_day",
    style: "fill: orange"
  },
  "wd_invite": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/wd_invite/wd_invite.kjb",
    style: "fill: orange"
  },
  "user_broker_relation": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/user_broker_relation/stg_user_broker_relation.kjb",
    style: "fill: orange"
  },
  "wd_ent_interview_cnt": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/wd_ent_interview_cnt/wd_ent_interview_cnt.kjb",
    style: "fill: orange"
  },
  "zxx2_etl_service": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/zxx2_etl_service/zxx2_etl_service.kjb",
    style: "fill: orange"
  },
  "wd_interview": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/wd_interview/wd_interview.kjb",
    style: "fill: orange"
  },
  "开始": {
    description: "开始",
    style: "fill: red"
  },
  "wd_broker": {
    description: "/usr/local/data-integration/pan.sh -file=/datas/kettle/jobs/dw-etl/wd_broker/wd_broker.ktr",
    style: "fill: orange"
  },
  "user_credict_month_day_work": {
    description: "/bin/bash /datas/airflow/dags/user_credict_month_day_work.sh ",
    style: "fill: orange"
  },
  "jff_etl_service": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/jff_etl_service/jff_etl_service.kjb",
    style: "fill: orange"
  },
  "结束": {
    description: "结束",
    style: "fill: lightblue"
  },
  "zxx_etl_service": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/zxx_etl_service/zxx_etl_service.kjb",
    style: "fill: orange"
  },
  "wait_until_success_ods_woda": {
    description: "/home/datas/.virtualenvs/env27/bin/python /home/datas/ods_controller/ods_controller_woda/task5_wait_until_success.py",
    style: "fill: green"
  },
  "zhouxin_performance_data": {
    description: "ssh 192.168.10.29 < /datas/airflow/dags/zhouxin_performance_data.cmd ",
    style: "fill: orange"
  },
  "wd_user": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/wd_user/wd_user_job.kjb",
    style: "fill: orange"
  },
  "wd_labor_order": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/wd_labor_order/wd_labor_order.kjb",
    style: "fill: orange"
  },
  "zxx2_credict": {
    description: "/usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/zxx_credict/zxx2_credict.kjb",
    style: "fill: orange"
  }
  };

  // Add states to the graph, set labels, and style
  Object.keys(states).forEach(function (state) {
    var value = states[state];
    value.label = state;
    value.id = state;
    value.rx = value.ry = 5;
    g1.setNode(state, value);
  });

  // Set up the edges
  g1.setEdge( "开始", "wait_until_success_ods_woda" , { label: "", curve: d3.curveBasis });
g1.setEdge( "开始", "wait_until_success_ods_jff" , { label: "", curve: d3.curveBasis });
g1.setEdge( "开始", "wait_until_success_ods_zxx" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_jff", "zxx2_etl_service" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_zxx", "zxx2_etl_service" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_jff", "jff_etl_service" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_jff", "zhouxin_jff1_sp_credict" , { label: "", curve: d3.curveBasis });
g1.setEdge( "zhouxin_jff1_sp_credict", "结束" , { label: "", curve: d3.curveBasis });
g1.setEdge( "zxx2_etl_service", "zhouxin_etl_service_cb_operation_data" , { label: "", curve: d3.curveBasis });
g1.setEdge( "jff_etl_service", "zhouxin_etl_service_cb_operation_data" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_woda", "interface_v2_daily_job_reguser_channel_operation" , { label: "", curve: d3.curveBasis });
g1.setEdge( "zhouxin_etl_service_cb_operation_data", "interface_v2_daily_job_reguser_channel_operation" , { label: "", curve: d3.curveBasis });
g1.setEdge( "interface_v2_daily_job_reguser_channel_operation", "结束" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_woda", "zhouxin_woda1_user_exam_result_server_all_total" , { label: "", curve: d3.curveBasis });
g1.setEdge( "zhouxin_woda1_user_exam_result_server_all_total", "zhouxin_woda2_cheat_detect" , { label: "", curve: d3.curveBasis });
g1.setEdge( "zhouxin_woda2_cheat_detect", "zhouxin_woda3_recommend" , { label: "", curve: d3.curveBasis });
g1.setEdge( "zhouxin_woda3_recommend", "结束" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_zxx", "zxx_etl_service" , { label: "", curve: d3.curveBasis });
g1.setEdge( "zxx_etl_service", "user_credict_month_day_work" , { label: "", curve: d3.curveBasis });
g1.setEdge( "user_credict_month_day_work", "zxx2_credict" , { label: "", curve: d3.curveBasis });
g1.setEdge( "zxx2_credict", "结束" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_woda", "dim_broker_cliff" , { label: "", curve: d3.curveBasis });
g1.setEdge( "dim_broker_cliff", "结束" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_woda", "zhouxin_name_list_analysis" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_jff", "zhouxin_name_list_analysis" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_zxx", "zhouxin_name_list_analysis" , { label: "", curve: d3.curveBasis });
g1.setEdge( "zxx_etl_service", "zhouxin_name_list_analysis" , { label: "", curve: d3.curveBasis });
g1.setEdge( "zhouxin_name_list_analysis", "结束" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_jff", "zhouxin_performance_data" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_zxx", "zhouxin_performance_data" , { label: "", curve: d3.curveBasis });
g1.setEdge( "zxx2_etl_service", "zhouxin_performance_data" , { label: "", curve: d3.curveBasis });
g1.setEdge( "jff_etl_service", "zhouxin_performance_data" , { label: "", curve: d3.curveBasis });
g1.setEdge( "zhouxin_performance_data", "结束" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_jff", "zhouxin_operator_data" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_zxx", "zhouxin_operator_data" , { label: "", curve: d3.curveBasis });
g1.setEdge( "zxx2_etl_service", "zhouxin_operator_data" , { label: "", curve: d3.curveBasis });
g1.setEdge( "jff_etl_service", "zhouxin_operator_data" , { label: "", curve: d3.curveBasis });
g1.setEdge( "zhouxin_operator_data", "结束" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_woda", "load_dim" , { label: "", curve: d3.curveBasis });
g1.setEdge( "load_dim", "wd_broker" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wd_broker", "wd_user" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wd_user", "user_broker_relation" , { label: "", curve: d3.curveBasis });
g1.setEdge( "user_broker_relation", "wd_recruit_demand" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wd_recruit_demand", "wd_preorder" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wd_preorder", "wd_interview" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wd_interview", "wd_hire" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wd_hire", "wd_invite" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wd_invite", "wd_subsidy" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wd_subsidy", "wd_interaction" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wd_interaction", "wd_labor_order" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wd_labor_order", "wd_ent_interview_cnt" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wd_ent_interview_cnt", "结束" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_woda", "financial" , { label: "", curve: d3.curveBasis });
g1.setEdge( "wait_until_success_ods_zxx", "financial" , { label: "", curve: d3.curveBasis });
g1.setEdge( "financial", "结束" , { label: "", curve: d3.curveBasis });


  // Create the renderer
  var render = new dagreD3.render();

  // Set up an SVG group so that we can translate the final graph.
  var svg = d3.select("#svg1"),
    inner1 = svg.append("g");

  // Set up zoom support
  var zoom = d3.zoom()
    .on("zoom", function () {
      inner1.attr("transform", d3.event.transform);
    });
  svg.call(zoom);

  // Simple function to style the tooltip for the given node.
  var styleTooltip = function (name, description) {
    return "<p class='name'>" + name + "</p><p class='description' style='color:orange; width:100%; height:100%; display:inline-block' >" + description +"<br>" + "</p>";
  };

  // Run the renderer. This is what draws the final graph.
  render(inner1, g1);

  inner1.selectAll("g.node")
    .attr("title", function (v) { return styleTooltip(v, g1.node(v).description) })
    .each(function (v) { $(this).tipsy({ gravity: "w", opacity: 1, html: true }); });

  inner1.selectAll("g.node").style("stroke-width", initialStrokeWidth);

  // function highlight nodes
  inner1.selectAll("g.node").on("mouseover", function (d) {
    inner1.selectAll("rect").style("stroke", highlight_color);
    g1.predecessors(d).forEach(function (nodeid) {
      my_node = inner1.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_upstream_color);
    })

    g1.successors(d).forEach(function (nodeid) {
      my_node = inner1.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_downstream_color);
    })
  });

  inner1.selectAll("g.node").on("mouseout", function (d) {
    inner1.selectAll("rect").style("stroke", null);
    g1.predecessors(d).forEach(function (nodeid) {
      my_node = inner1.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })

    g1.successors(d).forEach(function (nodeid) {
      my_node = inner1.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })
  });
  
  // Center the graph
  var initialScale = 0.75;
  svg.call(zoom.transform, d3.zoomIdentity.translate((svg.attr("width") - g1.graph().width * initialScale) / 2, 20).scale(initialScale));

  svg.attr('height', g1.graph().height * initialScale + 40);
</script>

<h3>司毅etl重跑</h3>
<svg width=960 height=800 id="svg2"></svg>
<script>
  var highlight_color = "#000000";
  var upstream_color = "#0000FF";
  var downstream_color = "#0000FF"
  var fill_default_color = "rgb(240, 237, 228)"
  var fill_upstream_color = "orange"
  var fill_downstream_color = "orange"
  var initialStrokeWidth = '3px';
  
  // Create a new directed graph
  var g2 = new dagreD3.graphlib.Graph().setGraph({});

  // States and transitions from RFC 793
  var states = {
    "market_prc_max": {
    description: "CDC_TABLE_NAME + STG_TABLE_NAME : market_prc_max",
    style: "fill: orange"
  },
  "ent_name_list_unique_sum": {
    description: "CDC_TABLE_NAME + STG_TABLE_NAME : ent_name_list_unique_sum",
    style: "fill: orange"
  },
  "jff_online_service": {
    description: "airflow的任务名",
    style: "fill: orange"
  },
  "ent_name_list_trend": {
    description: "CDC_TABLE_NAME + STG_TABLE_NAME : ent_name_list_trend",
    style: "fill: orange"
  },
  "ent_name_list_unique_trend": {
    description: "CDC_TABLE_NAME + STG_TABLE_NAME : ent_name_list_unique_trend",
    style: "fill: orange"
  },
  "zhouxinxin_retation": {
    description: "CDC_TABLE_NAME + STG_TABLE_NAME : zhouxinxin_retation",
    style: "fill: orange"
  },
  "stg_zhouxinxin_name_list": {
    description: "CDC_TABLE_NAME + STG_TABLE_NAME : stg_zhouxinxin_name_list",
    style: "fill: orange"
  },
  "area_prc_max": {
    description: "CDC_TABLE_NAME + STG_TABLE_NAME : area_prc_max",
    style: "fill: orange"
  },
  "jff_enterprise_service": {
    description: "etl工程目录 /usr/local/data-integration/kitchen.sh -file=/datas/kettle/jobs/dw-etl/<br>                                               jff_enterprise_service/jff_enterprise_service.kjb",
    style: "fill: orange"
  },
  "ent_name_list_sum": {
    description: "CDC_TABLE_NAME + STG_TABLE_NAME : ent_name_list_sum",
    style: "fill: orange"
  },
  "开始": {
    description: "开始",
    style: "fill: red"
  },
  "结束": {
    description: "结束",
    style: "fill: lightblue"
  },
  "direct_store_name_list_sum": {
    description: "CDC_TABLE_NAME + STG_TABLE_NAME: direct_store_name_list_sum",
    style: "fill: orange"
  }
  };

  // Add states to the graph, set labels, and style
  Object.keys(states).forEach(function (state) {
    var value = states[state];
    value.label = state;
    value.id = state;
    value.rx = value.ry = 5;
    g2.setNode(state, value);
  });

  // Set up the edges
  g2.setEdge( "开始", "jff_online_service" , { label: "", curve: d3.curveBasis });
g2.setEdge( "jff_online_service", "jff_enterprise_service" , { label: "", curve: d3.curveBasis });
g2.setEdge( "jff_enterprise_service", "direct_store_name_list_sum" , { label: "", curve: d3.curveBasis });
g2.setEdge( "jff_enterprise_service", "market_prc_max" , { label: "", curve: d3.curveBasis });
g2.setEdge( "jff_enterprise_service", "area_prc_max" , { label: "", curve: d3.curveBasis });
g2.setEdge( "jff_enterprise_service", "ent_name_list_sum" , { label: "", curve: d3.curveBasis });
g2.setEdge( "jff_enterprise_service", "ent_name_list_trend" , { label: "", curve: d3.curveBasis });
g2.setEdge( "jff_enterprise_service", "ent_name_list_unique_sum" , { label: "", curve: d3.curveBasis });
g2.setEdge( "jff_enterprise_service", "ent_name_list_unique_trend" , { label: "", curve: d3.curveBasis });
g2.setEdge( "jff_enterprise_service", "zhouxinxin_retation" , { label: "", curve: d3.curveBasis });
g2.setEdge( "jff_enterprise_service", "stg_zhouxinxin_name_list" , { label: "", curve: d3.curveBasis });
g2.setEdge( "direct_store_name_list_sum", "结束" , { label: "", curve: d3.curveBasis });
g2.setEdge( "market_prc_max", "结束" , { label: "", curve: d3.curveBasis });
g2.setEdge( "area_prc_max", "结束" , { label: "", curve: d3.curveBasis });
g2.setEdge( "ent_name_list_sum", "结束" , { label: "", curve: d3.curveBasis });
g2.setEdge( "ent_name_list_trend", "结束" , { label: "", curve: d3.curveBasis });
g2.setEdge( "ent_name_list_unique_sum", "结束" , { label: "", curve: d3.curveBasis });
g2.setEdge( "ent_name_list_unique_trend", "结束" , { label: "", curve: d3.curveBasis });
g2.setEdge( "zhouxinxin_retation", "结束" , { label: "", curve: d3.curveBasis });
g2.setEdge( "stg_zhouxinxin_name_list", "结束" , { label: "", curve: d3.curveBasis });


  // Create the renderer
  var render = new dagreD3.render();

  // Set up an SVG group so that we can translate the final graph.
  var svg = d3.select("#svg2"),
    inner2 = svg.append("g");

  // Set up zoom support
  var zoom = d3.zoom()
    .on("zoom", function () {
      inner2.attr("transform", d3.event.transform);
    });
  svg.call(zoom);

  // Simple function to style the tooltip for the given node.
  var styleTooltip = function (name, description) {
    return "<p class='name'>" + name + "</p><p class='description' style='color:orange; width:100%; height:100%; display:inline-block' >" + description +"<br>" + "</p>";
  };

  // Run the renderer. This is what draws the final graph.
  render(inner2, g2);

  inner2.selectAll("g.node")
    .attr("title", function (v) { return styleTooltip(v, g2.node(v).description) })
    .each(function (v) { $(this).tipsy({ gravity: "w", opacity: 1, html: true }); });

  inner2.selectAll("g.node").style("stroke-width", initialStrokeWidth);

  // function highlight nodes
  inner2.selectAll("g.node").on("mouseover", function (d) {
    inner2.selectAll("rect").style("stroke", highlight_color);
    g2.predecessors(d).forEach(function (nodeid) {
      my_node = inner2.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_upstream_color);
    })

    g2.successors(d).forEach(function (nodeid) {
      my_node = inner2.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_downstream_color);
    })
  });

  inner2.selectAll("g.node").on("mouseout", function (d) {
    inner2.selectAll("rect").style("stroke", null);
    g2.predecessors(d).forEach(function (nodeid) {
      my_node = inner2.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })

    g2.successors(d).forEach(function (nodeid) {
      my_node = inner2.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })
  });
  
  // Center the graph
  var initialScale = 0.75;
  svg.call(zoom.transform, d3.zoomIdentity.translate((svg.attr("width") - g2.graph().width * initialScale) / 2, 20).scale(initialScale));

  svg.attr('height', g2.graph().height * initialScale + 40);
</script>


