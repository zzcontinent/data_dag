<!doctype html>

<meta charset="utf-8">
<title>血缘分析DAG</title>

<link rel="stylesheet" href="demo.css">
<script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
<script src="./dagre-d3.js"></script>

<!-- Pull in JQuery dependencies -->
<link rel="stylesheet" href="tipsy.css">
<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="tipsy.js"></script>

<style id="css">
  text {
    font-weight: 300;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serf;
    font-size: 14px;
  }

  .node rect {
    stroke: #333;
    fill: #fff;
  }

  .edgePath path {
    stroke: #333;
    fill: #333;
    stroke-width: 1.5px;
  }

  .node text {
    pointer-events: none;
  }

  /* This styles the title of the tooltip */
  .tipsy .name {
    font-size: 1.5em;
    font-weight: bold;
    color: #60b1fc;
    margin: 0;
  }

  /* This styles the body of the tooltip */
  .tipsy .description {
    font-size: 1.2em;
  }

</style>

<h3>1 生成加盟店名单jff_ent_tmp.zhouxinxin_league_name_list</h3>
<svg width=960 height=800 id="svg1"></svg>
<script>
  var highlight_color = "#000000";
  var upstream_color = "#0000FF";
  var downstream_color = "#0000FF"
  var fill_default_color = "rgb(240, 237, 228)"
  var fill_upstream_color = "orange"
  var fill_downstream_color = "orange"
  var initialStrokeWidth = '3px';
  
  // Create a new directed graph
  var g1 = new dagreD3.graphlib.Graph().setGraph({});

  // States and transitions from RFC 793
  var states = {
    "id_1": {
    id: "id_1",
    label: "SQL",
    description: "<br>        insert into jff_ent_tmp.zhouxinxin_league_name_list(name_list_id, jff_name_list_id, ent_id,<br>    ent_short_name, sp_id, sp_short_name, labor_sp_id, labor_sp_short_name, order_id, id_card_num,<br>    interview_date, interview_status, work_card_num, work_status, entry_date, leave_date)<br>    SELECT a.name_list_id, a.jff_name_list_id, a.ent_id, d.ent_short_name, c.sp_id, c.league_name,<br>    e.real_b_sp_id, f.sp_short_name, a.rcrt_order_id, upper(a.id_card_num), a.intv_dt,<br>    a.intv_sts, a.work_card_no, a.work_sts, a.entry_dt, a.leave_dt<br>    FROM (<br>    	select name_list_id, jff_name_list_id, ent_id, id_card_num, if(work_card_no='', null, work_card_no) as work_card_no,<br>    	intv_dt, intv_sts, work_sts, entry_dt, leave_dt, rcrt_order_id, srce_sp_id, trgt_sp_id,<br>    	if(@intv_dt=temp.intv_dt and @id_card_num=temp.id_card_num, @rank := @rank+1, @rank := 1) as rank,<br>    	@intv_dt := temp.intv_dt,  @id_card_num := temp.id_card_num<br>    	from (<br>    		select name_list_id, jff_name_list_id, ent_id, upper(id_card_num) as id_card_num, trgt_sp_id,<br>    		work_card_no, intv_dt, intv_sts, work_sts, entry_dt, leave_dt, rcrt_order_id, srce_sp_id<br>    		from `ods_zxx_2.0`.name_list<br>    		where is_deleted = 1<br>    		order by intv_dt, id_card_num, name_list_id desc<br>    		) temp,<br>    		(select @intv_dt := null, @id_card_num := null, @rank := 0) r<br>    ) a<br>    left join `ods_zxx_2.0`.sp_mapping b on a.srce_sp_id = b.virtual_sp_id<br>    left join ods_jff.league_store c on b.real_sp_id = c.sp_id<br>    left join `ods_zxx_2.0`.ent d on a.ent_id = d.ent_id<br>    left join ods_jff.sp_real_coop e on a.trgt_sp_id = e.b_sp_id<br>    left join ods_jff.sp f on e.real_b_sp_id = f.sp_id<br>    where a.intv_dt >= c.coop_start_dt and a.rank = 1<br>    and c.sp_id != 1006;<br>        ",
    style: "fill: lightblue"
  },
  "id_2": {
    id: "id_2",
    label: "#meta77",
    description: "表 | ( SELECT name_list_id jff_name_list_id ent_id id_card_num if #meta72 AS work_card_no intv_dt intv_sts work_sts entry_dt leave_dt rcrt_order_id srce_sp_id trgt_sp_id if #meta73 AS rank @intv_dt := temp.intv_dt @id_card_num := temp.id_card_num FROM #meta75 TEMP #meta76 r )",
    style: "fill: blue"
  },
  "id_3": {
    id: "id_3",
    label: "`ods_zxx_2.0`.sp_mapping",
    description: "表",
    style: "fill: blue"
  },
  "id_4": {
    id: "id_4",
    label: "ods_jff.league_store",
    description: "表",
    style: "fill: blue"
  },
  "id_5": {
    id: "id_5",
    label: "`ods_zxx_2.0`.ent",
    description: "表",
    style: "fill: blue"
  },
  "id_6": {
    id: "id_6",
    label: "ods_jff.sp_real_coop",
    description: "表",
    style: "fill: blue"
  },
  "id_7": {
    id: "id_7",
    label: "ods_jff.sp",
    description: "表",
    style: "fill: blue"
  },
  "id_8": {
    id: "id_8",
    label: "#meta75",
    description: "表 | ( SELECT name_list_id jff_name_list_id ent_id upper #meta74 AS id_card_num trgt_sp_id work_card_no intv_dt intv_sts work_sts entry_dt leave_dt rcrt_order_id srce_sp_id FROM `ods_zxx_2.0`.name_list WHERE is_deleted = 1 ORDER BY intv_dt id_card_num name_list_id DESC )",
    style: "fill: blue"
  },
  "id_9": {
    id: "id_9",
    label: "#meta76",
    description: "表 | ( SELECT @intv_dt := NULL @id_card_num := NULL @rank := 0 )",
    style: "fill: blue"
  },
  "id_10": {
    id: "id_10",
    label: "`ods_zxx_2.0`.name_list",
    description: "表",
    style: "fill: blue"
  },
  "id_11": {
    id: "id_11",
    label: "jff_name_list_id",
    description: "字段",
    style: "fill: orange"
  },
  "id_12": {
    id: "id_12",
    label: "@intv_dt := NULL",
    description: "字段",
    style: "fill: orange"
  },
  "id_13": {
    id: "id_13",
    label: "work_sts",
    description: "字段",
    style: "fill: orange"
  },
  "id_14": {
    id: "id_14",
    label: "#meta72",
    description: "字段 | if ( work_card_no = '' NULL work_card_no ) ",
    style: "fill: orange"
  },
  "id_15": {
    id: "id_15",
    label: "#meta73",
    description: "字段 | if ( @intv_dt = temp.intv_dt AND @id_card_num = temp.id_card_num @rank := @rank + 1 @rank := 1 ) ",
    style: "fill: orange"
  },
  "id_16": {
    id: "id_16",
    label: "#meta71",
    description: "字段 | upper ( a.id_card_num ) ",
    style: "fill: orange"
  },
  "id_17": {
    id: "id_17",
    label: "leave_dt",
    description: "字段",
    style: "fill: orange"
  },
  "id_18": {
    id: "id_18",
    label: "@id_card_num := NULL",
    description: "字段",
    style: "fill: orange"
  },
  "id_19": {
    id: "id_19",
    label: "ent_short_name",
    description: "字段",
    style: "fill: orange"
  },
  "id_20": {
    id: "id_20",
    label: "sp_id",
    description: "字段",
    style: "fill: orange"
  },
  "id_21": {
    id: "id_21",
    label: "@intv_dt := temp.intv_dt",
    description: "字段",
    style: "fill: orange"
  },
  "id_22": {
    id: "id_22",
    label: "#meta74",
    description: "字段 | upper ( id_card_num ) ",
    style: "fill: orange"
  },
  "id_23": {
    id: "id_23",
    label: "trgt_sp_id",
    description: "字段",
    style: "fill: orange"
  },
  "id_24": {
    id: "id_24",
    label: "real_b_sp_id",
    description: "字段",
    style: "fill: orange"
  },
  "id_25": {
    id: "id_25",
    label: "@id_card_num := temp.id_card_num",
    description: "字段",
    style: "fill: orange"
  },
  "id_26": {
    id: "id_26",
    label: "intv_dt",
    description: "字段",
    style: "fill: orange"
  },
  "id_27": {
    id: "id_27",
    label: "srce_sp_id",
    description: "字段",
    style: "fill: orange"
  },
  "id_28": {
    id: "id_28",
    label: "entry_dt",
    description: "字段",
    style: "fill: orange"
  },
  "id_29": {
    id: "id_29",
    label: "name_list_id",
    description: "字段",
    style: "fill: orange"
  },
  "id_30": {
    id: "id_30",
    label: "rcrt_order_id",
    description: "字段",
    style: "fill: orange"
  },
  "id_31": {
    id: "id_31",
    label: "sp_short_name",
    description: "字段",
    style: "fill: orange"
  },
  "id_32": {
    id: "id_32",
    label: "intv_sts",
    description: "字段",
    style: "fill: orange"
  },
  "id_33": {
    id: "id_33",
    label: "league_name",
    description: "字段",
    style: "fill: orange"
  },
  "id_34": {
    id: "id_34",
    label: "ent_id",
    description: "字段",
    style: "fill: orange"
  },
  "id_35": {
    id: "id_35",
    label: "@rank := 0",
    description: "字段",
    style: "fill: orange"
  },
  "id_36": {
    id: "id_36",
    label: "id_card_num",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_37": {
    id: "id_37",
    label: "work_card_no",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_38": {
    id: "id_38",
    label: "rank",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_ts": {
    id: "id_ts",
    label: "开始",
    description: "开始",
    style: "fill: red"
  }
  };

  // Add states to the graph, set labels, and style
  Object.keys(states).forEach(function (state) {
    var value = states[state];
    value.rx = value.ry = 5;
    g1.setNode(state, value);
  });

  // Set up the edges
  g1.setEdge( "id_ts", "id_1" , { label: "" });
g1.setEdge( "id_22", "id_36" , { label: "" });
g1.setEdge( "id_14", "id_37" , { label: "" });
g1.setEdge( "id_15", "id_38" , { label: "" });
g1.setEdge( "id_10", "id_11" , { label: "" });
g1.setEdge( "id_9", "id_12" , { label: "" });
g1.setEdge( "id_10", "id_13" , { label: "" });
g1.setEdge( "id_2", "id_14" , { label: "" });
g1.setEdge( "id_2", "id_15" , { label: "" });
g1.setEdge( "id_1", "id_16" , { label: "" });
g1.setEdge( "id_10", "id_17" , { label: "" });
g1.setEdge( "id_9", "id_18" , { label: "" });
g1.setEdge( "id_5", "id_19" , { label: "" });
g1.setEdge( "id_4", "id_20" , { label: "" });
g1.setEdge( "id_2", "id_21" , { label: "" });
g1.setEdge( "id_10", "id_22" , { label: "" });
g1.setEdge( "id_10", "id_23" , { label: "" });
g1.setEdge( "id_6", "id_24" , { label: "" });
g1.setEdge( "id_2", "id_25" , { label: "" });
g1.setEdge( "id_10", "id_26" , { label: "" });
g1.setEdge( "id_10", "id_27" , { label: "" });
g1.setEdge( "id_10", "id_28" , { label: "" });
g1.setEdge( "id_10", "id_29" , { label: "" });
g1.setEdge( "id_10", "id_30" , { label: "" });
g1.setEdge( "id_7", "id_31" , { label: "" });
g1.setEdge( "id_10", "id_32" , { label: "" });
g1.setEdge( "id_4", "id_33" , { label: "" });
g1.setEdge( "id_10", "id_34" , { label: "" });
g1.setEdge( "id_9", "id_35" , { label: "" });
g1.setEdge( "id_8", "id_10" , { label: "" });
g1.setEdge( "id_1", "id_3" , { label: "" });
g1.setEdge( "id_2", "id_9" , { label: "" });
g1.setEdge( "id_1", "id_2" , { label: "" });
g1.setEdge( "id_2", "id_8" , { label: "" });
g1.setEdge( "id_1", "id_7" , { label: "" });
g1.setEdge( "id_1", "id_5" , { label: "" });
g1.setEdge( "id_1", "id_6" , { label: "" });
g1.setEdge( "id_1", "id_4" , { label: "" });


  // Create the renderer
  var render = new dagreD3.render();

  // Set up an SVG group so that we can translate the final graph.
  var svg = d3.select("#svg1"),
    inner1 = svg.append("g");

  // Set up zoom support
  var zoom = d3.zoom()
    .on("zoom", function () {
      inner1.attr("transform", d3.event.transform);
    });
  svg.call(zoom);

  // Simple function to style the tooltip for the given node.
  var styleTooltip = function (name, description) {
    return "<p class='name'>" + name + "</p><p class='description' style='color:orange; width:100%; height:100%; display:inline-block' >" + description +"<br>" + "</p>";
  };

  // Run the renderer. This is what draws the final graph.
  render(inner1, g1);

  inner1.selectAll("g.node")
    .attr("title", function (v) { return styleTooltip(g1.node(v).label, g1.node(v).description) })
    .each(function (v) { $(this).tipsy({ gravity: "w", opacity: 1, html: true }); });

  inner1.selectAll("g.node").style("stroke-width", initialStrokeWidth);

  // function highlight nodes
  inner1.selectAll("g.node").on("mouseover", function (d) {
    inner1.selectAll("rect").style("stroke", highlight_color);
    g1.predecessors(d).forEach(function (nodeid) {
      my_node = inner1.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_upstream_color);
    })

    g1.successors(d).forEach(function (nodeid) {
      my_node = inner1.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_downstream_color);
    })
  });

  inner1.selectAll("g.node").on("mouseout", function (d) {
    inner1.selectAll("rect").style("stroke", null);
    g1.predecessors(d).forEach(function (nodeid) {
      my_node = inner1.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })

    g1.successors(d).forEach(function (nodeid) {
      my_node = inner1.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })
  });
  
  // Center the graph
  var initialScale = 0.75;
  svg.call(zoom.transform, d3.zoomIdentity.translate((svg.attr("width") - g1.graph().width * initialScale) / 2, 20).scale(initialScale));

  svg.attr('height', g1.graph().height * initialScale + 40);
</script>

<h3>2.1 根据周薪薪的周月薪名单补充入职状态, 月+周账单里存在的，就是在职，没有的就是离职</h3>
<svg width=960 height=800 id="svg2"></svg>
<script>
  var highlight_color = "#000000";
  var upstream_color = "#0000FF";
  var downstream_color = "#0000FF"
  var fill_default_color = "rgb(240, 237, 228)"
  var fill_upstream_color = "orange"
  var fill_downstream_color = "orange"
  var initialStrokeWidth = '3px';
  
  // Create a new directed graph
  var g2 = new dagreD3.graphlib.Graph().setGraph({});

  // States and transitions from RFC 793
  var states = {
    "id_1": {
    id: "id_1",
    label: "SQL",
    description: "<br>            update jff_ent_tmp.zhouxinxin_league_name_list a<br>    inner join (<br>    	select ent_id, if(work_card_no='', null, work_card_no) as work_card_num, id_card_num, entry_dt as entry_date, leave_dt as leave_date,<br>    	if(@entry_dt=temp.entry_dt and @id_card_num=temp.id_card_num, @rank := @rank+1, @rank := 1) as rank,<br>    	@entry_dt := temp.entry_dt, @id_card_num := temp.id_card_num<br>    	from (<br>    		SELECT upper(id_card_num) as id_card_num, work_card_no, entry_dt, ent_id, max(leave_dt) as leave_dt, count(1) as num<br>    		FROM `ods_zxx_2.0`.bill_monthly_batch_import_detail<br>    		where entry_dt > '1970-01-01'<br>    		group by ent_id, upper(id_card_num), work_card_no, entry_dt<br>    		order by ent_id, id_card_num, entry_dt, num desc<br>    	)temp,<br>    	(select @entry_dt := null, @id_card_num := null, @rank := 0) r<br>    ) b on b.rank = 1 and a.id_card_num = b.id_card_num and coalesce(a.fixed_work_card_num, a.work_card_num) = b.work_card_num<br>    set a.hire_status = 1<br>    where a.interview_date >= '${MIN_INTV_DT}';",
    style: "fill: lightblue"
  },
  "id_2": {
    id: "id_2",
    label: "#meta86",
    description: "表 | ( SELECT ent_id if #meta78 AS work_card_num id_card_num entry_dt AS entry_date leave_dt AS leave_date if #meta79 AS rank @entry_dt := temp.entry_dt @id_card_num := temp.id_card_num FROM #meta84 TEMP #meta85 r )",
    style: "fill: blue"
  },
  "id_3": {
    id: "id_3",
    label: "#meta84",
    description: "表 | ( SELECT upper #meta80 AS id_card_num work_card_no entry_dt ent_id max #meta81 AS leave_dt count #meta82 AS num FROM `ods_zxx_2.0`.bill_monthly_batch_import_detail WHERE entry_dt > '1970 - 01 - 01' GROUP BY ent_id upper #meta83 work_card_no entry_dt ORDER BY ent_id id_card_num entry_dt num DESC )",
    style: "fill: blue"
  },
  "id_4": {
    id: "id_4",
    label: "#meta85",
    description: "表 | ( SELECT @entry_dt := NULL @id_card_num := NULL @rank := 0 )",
    style: "fill: blue"
  },
  "id_5": {
    id: "id_5",
    label: "`ods_zxx_2.0`.bill_monthly_batch_import_detail",
    description: "表",
    style: "fill: blue"
  },
  "id_6": {
    id: "id_6",
    label: "#meta82",
    description: "字段 | count ( 1 ) ",
    style: "fill: orange"
  },
  "id_7": {
    id: "id_7",
    label: "#meta81",
    description: "字段 | max ( leave_dt ) ",
    style: "fill: orange"
  },
  "id_8": {
    id: "id_8",
    label: "#meta80",
    description: "字段 | upper ( id_card_num ) ",
    style: "fill: orange"
  },
  "id_9": {
    id: "id_9",
    label: "@id_card_num := temp.id_card_num",
    description: "字段",
    style: "fill: orange"
  },
  "id_10": {
    id: "id_10",
    label: "#meta78",
    description: "字段 | if ( work_card_no = '' NULL work_card_no ) ",
    style: "fill: orange"
  },
  "id_11": {
    id: "id_11",
    label: "#meta79",
    description: "字段 | if ( @entry_dt = temp.entry_dt AND @id_card_num = temp.id_card_num @rank := @rank + 1 @rank := 1 ) ",
    style: "fill: orange"
  },
  "id_12": {
    id: "id_12",
    label: "@id_card_num := NULL",
    description: "字段",
    style: "fill: orange"
  },
  "id_13": {
    id: "id_13",
    label: "@entry_dt := NULL",
    description: "字段",
    style: "fill: orange"
  },
  "id_14": {
    id: "id_14",
    label: "work_card_no",
    description: "字段",
    style: "fill: orange"
  },
  "id_15": {
    id: "id_15",
    label: "entry_dt",
    description: "字段",
    style: "fill: orange"
  },
  "id_16": {
    id: "id_16",
    label: "@entry_dt := temp.entry_dt",
    description: "字段",
    style: "fill: orange"
  },
  "id_17": {
    id: "id_17",
    label: "ent_id",
    description: "字段",
    style: "fill: orange"
  },
  "id_18": {
    id: "id_18",
    label: "@rank := 0",
    description: "字段",
    style: "fill: orange"
  },
  "id_19": {
    id: "id_19",
    label: "num",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_20": {
    id: "id_20",
    label: "leave_dt",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_21": {
    id: "id_21",
    label: "id_card_num",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_22": {
    id: "id_22",
    label: "work_card_num",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_23": {
    id: "id_23",
    label: "rank",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_24": {
    id: "id_24",
    label: "leave_date",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_25": {
    id: "id_25",
    label: "entry_date",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_ts": {
    id: "id_ts",
    label: "开始",
    description: "开始",
    style: "fill: red"
  }
  };

  // Add states to the graph, set labels, and style
  Object.keys(states).forEach(function (state) {
    var value = states[state];
    value.rx = value.ry = 5;
    g2.setNode(state, value);
  });

  // Set up the edges
  g2.setEdge( "id_ts", "id_1" , { label: "" });
g2.setEdge( "id_6", "id_19" , { label: "" });
g2.setEdge( "id_7", "id_20" , { label: "" });
g2.setEdge( "id_8", "id_21" , { label: "" });
g2.setEdge( "id_10", "id_22" , { label: "" });
g2.setEdge( "id_11", "id_23" , { label: "" });
g2.setEdge( "id_20", "id_24" , { label: "" });
g2.setEdge( "id_15", "id_25" , { label: "" });
g2.setEdge( "id_5", "id_6" , { label: "" });
g2.setEdge( "id_5", "id_7" , { label: "" });
g2.setEdge( "id_5", "id_8" , { label: "" });
g2.setEdge( "id_2", "id_9" , { label: "" });
g2.setEdge( "id_2", "id_10" , { label: "" });
g2.setEdge( "id_2", "id_11" , { label: "" });
g2.setEdge( "id_4", "id_12" , { label: "" });
g2.setEdge( "id_4", "id_13" , { label: "" });
g2.setEdge( "id_5", "id_14" , { label: "" });
g2.setEdge( "id_5", "id_15" , { label: "" });
g2.setEdge( "id_2", "id_16" , { label: "" });
g2.setEdge( "id_5", "id_17" , { label: "" });
g2.setEdge( "id_4", "id_18" , { label: "" });
g2.setEdge( "id_3", "id_5" , { label: "" });
g2.setEdge( "id_1", "id_2" , { label: "" });
g2.setEdge( "id_2", "id_4" , { label: "" });
g2.setEdge( "id_2", "id_3" , { label: "" });


  // Create the renderer
  var render = new dagreD3.render();

  // Set up an SVG group so that we can translate the final graph.
  var svg = d3.select("#svg2"),
    inner2 = svg.append("g");

  // Set up zoom support
  var zoom = d3.zoom()
    .on("zoom", function () {
      inner2.attr("transform", d3.event.transform);
    });
  svg.call(zoom);

  // Simple function to style the tooltip for the given node.
  var styleTooltip = function (name, description) {
    return "<p class='name'>" + name + "</p><p class='description' style='color:orange; width:100%; height:100%; display:inline-block' >" + description +"<br>" + "</p>";
  };

  // Run the renderer. This is what draws the final graph.
  render(inner2, g2);

  inner2.selectAll("g.node")
    .attr("title", function (v) { return styleTooltip(g2.node(v).label, g2.node(v).description) })
    .each(function (v) { $(this).tipsy({ gravity: "w", opacity: 1, html: true }); });

  inner2.selectAll("g.node").style("stroke-width", initialStrokeWidth);

  // function highlight nodes
  inner2.selectAll("g.node").on("mouseover", function (d) {
    inner2.selectAll("rect").style("stroke", highlight_color);
    g2.predecessors(d).forEach(function (nodeid) {
      my_node = inner2.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_upstream_color);
    })

    g2.successors(d).forEach(function (nodeid) {
      my_node = inner2.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_downstream_color);
    })
  });

  inner2.selectAll("g.node").on("mouseout", function (d) {
    inner2.selectAll("rect").style("stroke", null);
    g2.predecessors(d).forEach(function (nodeid) {
      my_node = inner2.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })

    g2.successors(d).forEach(function (nodeid) {
      my_node = inner2.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })
  });
  
  // Center the graph
  var initialScale = 0.75;
  svg.call(zoom.transform, d3.zoomIdentity.translate((svg.attr("width") - g2.graph().width * initialScale) / 2, 20).scale(initialScale));

  svg.attr('height', g2.graph().height * initialScale + 40);
</script>

<h3>2.2 根据周薪薪的周月薪名单补充入职状态, 月+周账单里存在的，就是在职，没有的就是离职</h3>
<svg width=960 height=800 id="svg3"></svg>
<script>
  var highlight_color = "#000000";
  var upstream_color = "#0000FF";
  var downstream_color = "#0000FF"
  var fill_default_color = "rgb(240, 237, 228)"
  var fill_upstream_color = "orange"
  var fill_downstream_color = "orange"
  var initialStrokeWidth = '3px';
  
  // Create a new directed graph
  var g3 = new dagreD3.graphlib.Graph().setGraph({});

  // States and transitions from RFC 793
  var states = {
    "id_1": {
    id: "id_1",
    label: "SQL",
    description: "<br>            update jff_ent_tmp.zhouxinxin_league_name_list a<br>    inner join (<br>    	select ent_id, if(work_card_no='', null, work_card_no) as work_card_num, id_card_num, entry_dt as entry_date, leave_dt as leave_date,<br>    	if(@entry_dt=temp.entry_dt and @id_card_num=temp.id_card_num, @rank := @rank+1, @rank := 1) as rank,<br>    	@entry_dt := temp.entry_dt, @id_card_num := temp.id_card_num<br>    	from (<br>    		SELECT upper(id_card_num) as id_card_num, work_card_no, entry_dt, ent_id, max(leave_dt) as leave_dt, count(1) as num<br>    		FROM `ods_zxx_2.0`.bill_weekly_batch_import_detail<br>    		where entry_dt > '1970-01-01'<br>    		group by ent_id, upper(id_card_num), work_card_no, entry_dt<br>    		order by ent_id, id_card_num, entry_dt, num desc<br>    	)temp,<br>    	(select @entry_dt := null, @id_card_num := null, @rank := 0) r<br>    ) b on b.rank = 1 and a.id_card_num = b.id_card_num and coalesce(a.fixed_work_card_num, a.work_card_num) = b.work_card_num<br>    set a.hire_status = 1<br>    where a.interview_date >= '${MIN_INTV_DT}';<br><br>    update jff_ent_tmp.zhouxinxin_league_name_list<br>    set hire_status = 0<br>    where hire_status is null<br>    and interview_date >= '${MIN_INTV_D}' ",
    style: "fill: lightblue"
  },
  "id_2": {
    id: "id_2",
    label: "#meta96",
    description: "表 | ( SELECT ent_id if #meta88 AS work_card_num id_card_num entry_dt AS entry_date leave_dt AS leave_date if #meta89 AS rank @entry_dt := temp.entry_dt @id_card_num := temp.id_card_num FROM #meta94 TEMP #meta95 r )",
    style: "fill: blue"
  },
  "id_3": {
    id: "id_3",
    label: "#meta94",
    description: "表 | ( SELECT upper #meta90 AS id_card_num work_card_no entry_dt ent_id max #meta91 AS leave_dt count #meta92 AS num FROM `ods_zxx_2.0`.bill_weekly_batch_import_detail WHERE entry_dt > '1970 - 01 - 01' GROUP BY ent_id upper #meta93 work_card_no entry_dt ORDER BY ent_id id_card_num entry_dt num DESC )",
    style: "fill: blue"
  },
  "id_4": {
    id: "id_4",
    label: "#meta95",
    description: "表 | ( SELECT @entry_dt := NULL @id_card_num := NULL @rank := 0 )",
    style: "fill: blue"
  },
  "id_5": {
    id: "id_5",
    label: "`ods_zxx_2.0`.bill_weekly_batch_import_detail",
    description: "表",
    style: "fill: blue"
  },
  "id_6": {
    id: "id_6",
    label: "#meta90",
    description: "字段 | upper ( id_card_num ) ",
    style: "fill: orange"
  },
  "id_7": {
    id: "id_7",
    label: "#meta91",
    description: "字段 | max ( leave_dt ) ",
    style: "fill: orange"
  },
  "id_8": {
    id: "id_8",
    label: "#meta92",
    description: "字段 | count ( 1 ) ",
    style: "fill: orange"
  },
  "id_9": {
    id: "id_9",
    label: "@id_card_num := temp.id_card_num",
    description: "字段",
    style: "fill: orange"
  },
  "id_10": {
    id: "id_10",
    label: "@id_card_num := NULL",
    description: "字段",
    style: "fill: orange"
  },
  "id_11": {
    id: "id_11",
    label: "#meta89",
    description: "字段 | if ( @entry_dt = temp.entry_dt AND @id_card_num = temp.id_card_num @rank := @rank + 1 @rank := 1 ) ",
    style: "fill: orange"
  },
  "id_12": {
    id: "id_12",
    label: "#meta88",
    description: "字段 | if ( work_card_no = '' NULL work_card_no ) ",
    style: "fill: orange"
  },
  "id_13": {
    id: "id_13",
    label: "@entry_dt := NULL",
    description: "字段",
    style: "fill: orange"
  },
  "id_14": {
    id: "id_14",
    label: "work_card_no",
    description: "字段",
    style: "fill: orange"
  },
  "id_15": {
    id: "id_15",
    label: "entry_dt",
    description: "字段",
    style: "fill: orange"
  },
  "id_16": {
    id: "id_16",
    label: "@entry_dt := temp.entry_dt",
    description: "字段",
    style: "fill: orange"
  },
  "id_17": {
    id: "id_17",
    label: "ent_id",
    description: "字段",
    style: "fill: orange"
  },
  "id_18": {
    id: "id_18",
    label: "@rank := 0",
    description: "字段",
    style: "fill: orange"
  },
  "id_19": {
    id: "id_19",
    label: "id_card_num",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_20": {
    id: "id_20",
    label: "leave_dt",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_21": {
    id: "id_21",
    label: "num",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_22": {
    id: "id_22",
    label: "rank",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_23": {
    id: "id_23",
    label: "work_card_num",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_24": {
    id: "id_24",
    label: "leave_date",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_25": {
    id: "id_25",
    label: "entry_date",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_ts": {
    id: "id_ts",
    label: "开始",
    description: "开始",
    style: "fill: red"
  }
  };

  // Add states to the graph, set labels, and style
  Object.keys(states).forEach(function (state) {
    var value = states[state];
    value.rx = value.ry = 5;
    g3.setNode(state, value);
  });

  // Set up the edges
  g3.setEdge( "id_ts", "id_1" , { label: "" });
g3.setEdge( "id_6", "id_19" , { label: "" });
g3.setEdge( "id_7", "id_20" , { label: "" });
g3.setEdge( "id_8", "id_21" , { label: "" });
g3.setEdge( "id_11", "id_22" , { label: "" });
g3.setEdge( "id_12", "id_23" , { label: "" });
g3.setEdge( "id_20", "id_24" , { label: "" });
g3.setEdge( "id_15", "id_25" , { label: "" });
g3.setEdge( "id_5", "id_6" , { label: "" });
g3.setEdge( "id_5", "id_7" , { label: "" });
g3.setEdge( "id_5", "id_8" , { label: "" });
g3.setEdge( "id_2", "id_9" , { label: "" });
g3.setEdge( "id_4", "id_10" , { label: "" });
g3.setEdge( "id_2", "id_11" , { label: "" });
g3.setEdge( "id_2", "id_12" , { label: "" });
g3.setEdge( "id_4", "id_13" , { label: "" });
g3.setEdge( "id_5", "id_14" , { label: "" });
g3.setEdge( "id_5", "id_15" , { label: "" });
g3.setEdge( "id_2", "id_16" , { label: "" });
g3.setEdge( "id_5", "id_17" , { label: "" });
g3.setEdge( "id_4", "id_18" , { label: "" });
g3.setEdge( "id_2", "id_3" , { label: "" });
g3.setEdge( "id_2", "id_4" , { label: "" });
g3.setEdge( "id_1", "id_2" , { label: "" });
g3.setEdge( "id_3", "id_5" , { label: "" });


  // Create the renderer
  var render = new dagreD3.render();

  // Set up an SVG group so that we can translate the final graph.
  var svg = d3.select("#svg3"),
    inner3 = svg.append("g");

  // Set up zoom support
  var zoom = d3.zoom()
    .on("zoom", function () {
      inner3.attr("transform", d3.event.transform);
    });
  svg.call(zoom);

  // Simple function to style the tooltip for the given node.
  var styleTooltip = function (name, description) {
    return "<p class='name'>" + name + "</p><p class='description' style='color:orange; width:100%; height:100%; display:inline-block' >" + description +"<br>" + "</p>";
  };

  // Run the renderer. This is what draws the final graph.
  render(inner3, g3);

  inner3.selectAll("g.node")
    .attr("title", function (v) { return styleTooltip(g3.node(v).label, g3.node(v).description) })
    .each(function (v) { $(this).tipsy({ gravity: "w", opacity: 1, html: true }); });

  inner3.selectAll("g.node").style("stroke-width", initialStrokeWidth);

  // function highlight nodes
  inner3.selectAll("g.node").on("mouseover", function (d) {
    inner3.selectAll("rect").style("stroke", highlight_color);
    g3.predecessors(d).forEach(function (nodeid) {
      my_node = inner3.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_upstream_color);
    })

    g3.successors(d).forEach(function (nodeid) {
      my_node = inner3.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_downstream_color);
    })
  });

  inner3.selectAll("g.node").on("mouseout", function (d) {
    inner3.selectAll("rect").style("stroke", null);
    g3.predecessors(d).forEach(function (nodeid) {
      my_node = inner3.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })

    g3.successors(d).forEach(function (nodeid) {
      my_node = inner3.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })
  });
  
  // Center the graph
  var initialScale = 0.75;
  svg.call(zoom.transform, d3.zoomIdentity.translate((svg.attr("width") - g3.graph().width * initialScale) / 2, 20).scale(initialScale));

  svg.attr('height', g3.graph().height * initialScale + 40);
</script>

<h3>3 抽取字段生成简易加盟店名单jff_ent_tmp.jff_cb_name_list</h3>
<svg width=960 height=800 id="svg4"></svg>
<script>
  var highlight_color = "#000000";
  var upstream_color = "#0000FF";
  var downstream_color = "#0000FF"
  var fill_default_color = "rgb(240, 237, 228)"
  var fill_upstream_color = "orange"
  var fill_downstream_color = "orange"
  var initialStrokeWidth = '3px';
  
  // Create a new directed graph
  var g4 = new dagreD3.graphlib.Graph().setGraph({});

  // States and transitions from RFC 793
  var states = {
    "id_1": {
    id: "id_1",
    label: "SQL",
    description: "<br>            insert data into jff_cb_name_list：<br>    SELECT distinct a.name_list_id, a.mbr_id_card_num,<br>    c.sp_id,  a.intv_dt, a.rcrt_typ,<br>    a.intv_sts, b.hire_status<br>    FROM `ods_jff`.name_list a<br>    left join ods_jff.league_store c on a.sp_id = c.sp_id<br>    left join jff_ent_tmp.zhouxinxin_league_name_list b<br>    on upper(a.mbr_id_card_num)=b.id_card_num and a.intv_dt=b.interview_date<br>    where a.intv_dt >= c.coop_start_dt<br>    and a.intv_dt <= CURRENT_DATE<br>    and c.sp_id != 1006 and a.is_deleted = 0; ",
    style: "fill: lightblue"
  },
  "id_2": {
    id: "id_2",
    label: "`ods_jff`.name_list",
    description: "表",
    style: "fill: blue"
  },
  "id_3": {
    id: "id_3",
    label: "ods_jff.league_store",
    description: "表",
    style: "fill: blue"
  },
  "id_4": {
    id: "id_4",
    label: "jff_ent_tmp.zhouxinxin_league_name_list",
    description: "表",
    style: "fill: blue"
  },
  "id_5": {
    id: "id_5",
    label: "hire_status",
    description: "字段",
    style: "fill: orange"
  },
  "id_6": {
    id: "id_6",
    label: "intv_dt",
    description: "字段",
    style: "fill: orange"
  },
  "id_7": {
    id: "id_7",
    label: "sp_id",
    description: "字段",
    style: "fill: orange"
  },
  "id_8": {
    id: "id_8",
    label: "intv_sts",
    description: "字段",
    style: "fill: orange"
  },
  "id_9": {
    id: "id_9",
    label: "name_list_id",
    description: "字段",
    style: "fill: orange"
  },
  "id_10": {
    id: "id_10",
    label: "rcrt_typ",
    description: "字段",
    style: "fill: orange"
  },
  "id_11": {
    id: "id_11",
    label: "mbr_id_card_num",
    description: "字段",
    style: "fill: orange"
  },
  "id_ts": {
    id: "id_ts",
    label: "开始",
    description: "开始",
    style: "fill: red"
  }
  };

  // Add states to the graph, set labels, and style
  Object.keys(states).forEach(function (state) {
    var value = states[state];
    value.rx = value.ry = 5;
    g4.setNode(state, value);
  });

  // Set up the edges
  g4.setEdge( "id_ts", "id_1" , { label: "" });
g4.setEdge( "id_4", "id_5" , { label: "" });
g4.setEdge( "id_2", "id_6" , { label: "" });
g4.setEdge( "id_3", "id_7" , { label: "" });
g4.setEdge( "id_2", "id_8" , { label: "" });
g4.setEdge( "id_2", "id_9" , { label: "" });
g4.setEdge( "id_2", "id_10" , { label: "" });
g4.setEdge( "id_2", "id_11" , { label: "" });
g4.setEdge( "id_1", "id_2" , { label: "" });
g4.setEdge( "id_1", "id_3" , { label: "" });
g4.setEdge( "id_1", "id_4" , { label: "" });


  // Create the renderer
  var render = new dagreD3.render();

  // Set up an SVG group so that we can translate the final graph.
  var svg = d3.select("#svg4"),
    inner4 = svg.append("g");

  // Set up zoom support
  var zoom = d3.zoom()
    .on("zoom", function () {
      inner4.attr("transform", d3.event.transform);
    });
  svg.call(zoom);

  // Simple function to style the tooltip for the given node.
  var styleTooltip = function (name, description) {
    return "<p class='name'>" + name + "</p><p class='description' style='color:orange; width:100%; height:100%; display:inline-block' >" + description +"<br>" + "</p>";
  };

  // Run the renderer. This is what draws the final graph.
  render(inner4, g4);

  inner4.selectAll("g.node")
    .attr("title", function (v) { return styleTooltip(g4.node(v).label, g4.node(v).description) })
    .each(function (v) { $(this).tipsy({ gravity: "w", opacity: 1, html: true }); });

  inner4.selectAll("g.node").style("stroke-width", initialStrokeWidth);

  // function highlight nodes
  inner4.selectAll("g.node").on("mouseover", function (d) {
    inner4.selectAll("rect").style("stroke", highlight_color);
    g4.predecessors(d).forEach(function (nodeid) {
      my_node = inner4.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_upstream_color);
    })

    g4.successors(d).forEach(function (nodeid) {
      my_node = inner4.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_downstream_color);
    })
  });

  inner4.selectAll("g.node").on("mouseout", function (d) {
    inner4.selectAll("rect").style("stroke", null);
    g4.predecessors(d).forEach(function (nodeid) {
      my_node = inner4.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })

    g4.successors(d).forEach(function (nodeid) {
      my_node = inner4.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })
  });
  
  // Center the graph
  var initialScale = 0.75;
  svg.call(zoom.transform, d3.zoomIdentity.translate((svg.attr("width") - g4.graph().width * initialScale) / 2, 20).scale(initialScale));

  svg.attr('height', g4.graph().height * initialScale + 40);
</script>

<h3>4 生成统计结果</h3>
<svg width=960 height=800 id="svg5"></svg>
<script>
  var highlight_color = "#000000";
  var upstream_color = "#0000FF";
  var downstream_color = "#0000FF"
  var fill_default_color = "rgb(240, 237, 228)"
  var fill_upstream_color = "orange"
  var fill_downstream_color = "orange"
  var initialStrokeWidth = '3px';
  
  // Create a new directed graph
  var g5 = new dagreD3.graphlib.Graph().setGraph({});

  // States and transitions from RFC 793
  var states = {
    "id_1": {
    id: "id_1",
    label: "SQL",
    description: "<br>            select intv_dt, DATE_FORMAT(intv_dt, '%Y-%m') as interview_month,<br>    count(*) as d_total,<br>    count(rcrt_typ=2 or null) as d_zxx_total,<br>    count(intv_sts=2 or null) as d_intv,<br>    count(rcrt_typ=2 and intv_sts=2 or null) as d_zxx_intv,<br>    count(rcrt_typ=2 and intv_sts=2 and hire_status=1 or null) as d_zxx_hire,<br>    count(rcrt_typ=0 or null) as d_nzxx_total,<br>    count(rcrt_typ=0 and intv_sts=2 or null) as d_nzxx_intv<br>    from jff_ent_tmp.jff_cb_name_list<br>    group by intv_dt ",
    style: "fill: lightblue"
  },
  "id_2": {
    id: "id_2",
    label: "jff_ent_tmp.jff_cb_name_list",
    description: "表",
    style: "fill: blue"
  },
  "id_3": {
    id: "id_3",
    label: "#meta99",
    description: "字段 | DATE_FORMAT ( intv_dt '%Y - %m' ) ",
    style: "fill: orange"
  },
  "id_4": {
    id: "id_4",
    label: "intv_dt",
    description: "字段",
    style: "fill: orange"
  },
  "id_5": {
    id: "id_5",
    label: "#meta105",
    description: "字段 | count ( rcrt_typ = 0 OR NULL ) ",
    style: "fill: orange"
  },
  "id_6": {
    id: "id_6",
    label: "#meta104",
    description: "字段 | count ( rcrt_typ = 2 AND intv_sts = 2 AND hire_status = 1 OR NULL ) ",
    style: "fill: orange"
  },
  "id_7": {
    id: "id_7",
    label: "#meta106",
    description: "字段 | count ( rcrt_typ = 0 AND intv_sts = 2 OR NULL ) ",
    style: "fill: orange"
  },
  "id_8": {
    id: "id_8",
    label: "#meta101",
    description: "字段 | count ( rcrt_typ = 2 OR NULL ) ",
    style: "fill: orange"
  },
  "id_9": {
    id: "id_9",
    label: "#meta100",
    description: "字段 | count ( * ) ",
    style: "fill: orange"
  },
  "id_10": {
    id: "id_10",
    label: "#meta103",
    description: "字段 | count ( rcrt_typ = 2 AND intv_sts = 2 OR NULL ) ",
    style: "fill: orange"
  },
  "id_11": {
    id: "id_11",
    label: "#meta102",
    description: "字段 | count ( intv_sts = 2 OR NULL ) ",
    style: "fill: orange"
  },
  "id_12": {
    id: "id_12",
    label: "interview_month",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_ts": {
    id: "id_ts",
    label: "开始",
    description: "开始",
    style: "fill: red"
  },
  "id_14": {
    id: "id_14",
    label: "d_zxx_hire",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_13": {
    id: "id_13",
    label: "d_nzxx_total",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_16": {
    id: "id_16",
    label: "d_zxx_total",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_17": {
    id: "id_17",
    label: "d_total",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_18": {
    id: "id_18",
    label: "d_zxx_intv",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_19": {
    id: "id_19",
    label: "d_intv",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_15": {
    id: "id_15",
    label: "d_nzxx_intv",
    description: "字段别名",
    style: "fill: pink"
  }
  };

  // Add states to the graph, set labels, and style
  Object.keys(states).forEach(function (state) {
    var value = states[state];
    value.rx = value.ry = 5;
    g5.setNode(state, value);
  });

  // Set up the edges
  g5.setEdge( "id_ts", "id_1" , { label: "" });
g5.setEdge( "id_3", "id_12" , { label: "" });
g5.setEdge( "id_5", "id_13" , { label: "" });
g5.setEdge( "id_6", "id_14" , { label: "" });
g5.setEdge( "id_7", "id_15" , { label: "" });
g5.setEdge( "id_8", "id_16" , { label: "" });
g5.setEdge( "id_9", "id_17" , { label: "" });
g5.setEdge( "id_10", "id_18" , { label: "" });
g5.setEdge( "id_11", "id_19" , { label: "" });
g5.setEdge( "id_2", "id_3" , { label: "" });
g5.setEdge( "id_2", "id_4" , { label: "" });
g5.setEdge( "id_2", "id_5" , { label: "" });
g5.setEdge( "id_2", "id_6" , { label: "" });
g5.setEdge( "id_2", "id_7" , { label: "" });
g5.setEdge( "id_2", "id_8" , { label: "" });
g5.setEdge( "id_2", "id_9" , { label: "" });
g5.setEdge( "id_2", "id_10" , { label: "" });
g5.setEdge( "id_2", "id_11" , { label: "" });
g5.setEdge( "id_1", "id_2" , { label: "" });


  // Create the renderer
  var render = new dagreD3.render();

  // Set up an SVG group so that we can translate the final graph.
  var svg = d3.select("#svg5"),
    inner5 = svg.append("g");

  // Set up zoom support
  var zoom = d3.zoom()
    .on("zoom", function () {
      inner5.attr("transform", d3.event.transform);
    });
  svg.call(zoom);

  // Simple function to style the tooltip for the given node.
  var styleTooltip = function (name, description) {
    return "<p class='name'>" + name + "</p><p class='description' style='color:orange; width:100%; height:100%; display:inline-block' >" + description +"<br>" + "</p>";
  };

  // Run the renderer. This is what draws the final graph.
  render(inner5, g5);

  inner5.selectAll("g.node")
    .attr("title", function (v) { return styleTooltip(g5.node(v).label, g5.node(v).description) })
    .each(function (v) { $(this).tipsy({ gravity: "w", opacity: 1, html: true }); });

  inner5.selectAll("g.node").style("stroke-width", initialStrokeWidth);

  // function highlight nodes
  inner5.selectAll("g.node").on("mouseover", function (d) {
    inner5.selectAll("rect").style("stroke", highlight_color);
    g5.predecessors(d).forEach(function (nodeid) {
      my_node = inner5.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_upstream_color);
    })

    g5.successors(d).forEach(function (nodeid) {
      my_node = inner5.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_downstream_color);
    })
  });

  inner5.selectAll("g.node").on("mouseout", function (d) {
    inner5.selectAll("rect").style("stroke", null);
    g5.predecessors(d).forEach(function (nodeid) {
      my_node = inner5.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })

    g5.successors(d).forEach(function (nodeid) {
      my_node = inner5.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })
  });
  
  // Center the graph
  var initialScale = 0.75;
  svg.call(zoom.transform, d3.zoomIdentity.translate((svg.attr("width") - g5.graph().width * initialScale) / 2, 20).scale(initialScale));

  svg.attr('height', g5.graph().height * initialScale + 40);
</script>

<h3>4 生成统计结果</h3>
<svg width=960 height=800 id="svg6"></svg>
<script>
  var highlight_color = "#000000";
  var upstream_color = "#0000FF";
  var downstream_color = "#0000FF"
  var fill_default_color = "rgb(240, 237, 228)"
  var fill_upstream_color = "orange"
  var fill_downstream_color = "orange"
  var initialStrokeWidth = '3px';
  
  // Create a new directed graph
  var g6 = new dagreD3.graphlib.Graph().setGraph({});

  // States and transitions from RFC 793
  var states = {
    "id_1": {
    id: "id_1",
    label: "SQL",
    description: "<br>            select<br>    count(distinct vIDCardNum) as cnt<br>    from<br>    ods_woda.tbbrokeruserorderstatus ta<br>    where<br>    eStatus=1<br>    and dtcheckintime>=%s<br>    and dtcheckintime<%s<br>    and  iCheckinRecruitTmpID in (<br>            select iRecruitTmpID from ods_woda.tbRecruitTmp where vPositionName like '%%周薪薪%%' and eStatus=1<br>    )<br>    and eInterviewStatus in(1,2)<br>    and eJFFInterviewStatus=2<br>    and exists(<br>    select<br>    mbr_id_card_num<br>    from<br>    ods_jff.name_list<br>    where<br>    intv_dt>=%s<br>    and intv_dt<%s<br>    and rcrt_typ=1<br>    and is_deleted=0<br>    and left(ta.dtCheckinTime,10) = intv_dt<br>    and ta.vIDCardNum = mbr_id_card_num<br>    )",
    style: "fill: lightblue"
  },
  "id_2": {
    id: "id_2",
    label: "ods_woda.tbbrokeruserorderstatus",
    description: "表",
    style: "fill: blue"
  },
  "id_3": {
    id: "id_3",
    label: "#meta107",
    description: "字段 | count ( vIDCardNum ) ",
    style: "fill: orange"
  },
  "id_4": {
    id: "id_4",
    label: "cnt",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_ts": {
    id: "id_ts",
    label: "开始",
    description: "开始",
    style: "fill: red"
  }
  };

  // Add states to the graph, set labels, and style
  Object.keys(states).forEach(function (state) {
    var value = states[state];
    value.rx = value.ry = 5;
    g6.setNode(state, value);
  });

  // Set up the edges
  g6.setEdge( "id_ts", "id_1" , { label: "" });
g6.setEdge( "id_3", "id_4" , { label: "" });
g6.setEdge( "id_2", "id_3" , { label: "" });
g6.setEdge( "id_1", "id_2" , { label: "" });


  // Create the renderer
  var render = new dagreD3.render();

  // Set up an SVG group so that we can translate the final graph.
  var svg = d3.select("#svg6"),
    inner6 = svg.append("g");

  // Set up zoom support
  var zoom = d3.zoom()
    .on("zoom", function () {
      inner6.attr("transform", d3.event.transform);
    });
  svg.call(zoom);

  // Simple function to style the tooltip for the given node.
  var styleTooltip = function (name, description) {
    return "<p class='name'>" + name + "</p><p class='description' style='color:orange; width:100%; height:100%; display:inline-block' >" + description +"<br>" + "</p>";
  };

  // Run the renderer. This is what draws the final graph.
  render(inner6, g6);

  inner6.selectAll("g.node")
    .attr("title", function (v) { return styleTooltip(g6.node(v).label, g6.node(v).description) })
    .each(function (v) { $(this).tipsy({ gravity: "w", opacity: 1, html: true }); });

  inner6.selectAll("g.node").style("stroke-width", initialStrokeWidth);

  // function highlight nodes
  inner6.selectAll("g.node").on("mouseover", function (d) {
    inner6.selectAll("rect").style("stroke", highlight_color);
    g6.predecessors(d).forEach(function (nodeid) {
      my_node = inner6.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_upstream_color);
    })

    g6.successors(d).forEach(function (nodeid) {
      my_node = inner6.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_downstream_color);
    })
  });

  inner6.selectAll("g.node").on("mouseout", function (d) {
    inner6.selectAll("rect").style("stroke", null);
    g6.predecessors(d).forEach(function (nodeid) {
      my_node = inner6.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })

    g6.successors(d).forEach(function (nodeid) {
      my_node = inner6.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })
  });
  
  // Center the graph
  var initialScale = 0.75;
  svg.call(zoom.transform, d3.zoomIdentity.translate((svg.attr("width") - g6.graph().width * initialScale) / 2, 20).scale(initialScale));

  svg.attr('height', g6.graph().height * initialScale + 40);
</script>

<h3>测试</h3>
<svg width=960 height=800 id="svg7"></svg>
<script>
  var highlight_color = "#000000";
  var upstream_color = "#0000FF";
  var downstream_color = "#0000FF"
  var fill_default_color = "rgb(240, 237, 228)"
  var fill_upstream_color = "orange"
  var fill_downstream_color = "orange"
  var initialStrokeWidth = '3px';
  
  // Create a new directed graph
  var g7 = new dagreD3.graphlib.Graph().setGraph({});

  // States and transitions from RFC 793
  var states = {
    "id_1": {
    id: "id_1",
    label: "SQL",
    description: "<br>        select sum(tta.m),sum(tta.days) ,<br>sum(tta.m)/sum(tta.days),<br>left(entry_dt,7) as month<br>from<br>(<br>select<br>begin_dt,end_dt,entry_dt,leave_dt,<br>case when entry_dt>end_dt then 0<br>when entry_dt>=begin_dt and end_dt<=leave_dt and leave_dt is not null then datediff(end_dt,entry_dt)<br>when entry_dt>=begin_dt and leave_dt is null then datediff(end_dt,entry_dt)<br>when entry_dt>=begin_dt and end_dt>=leave_dt and   leave_dt is not null  then datediff(end_dt,entry_dt)<br>when entry_dt<begin_dt and end_dt<=leave_dt and leave_dt is not null then datediff(end_dt,begin_dt)<br>when entry_dt<begin_dt and leave_dt is null then datediff(end_dt,begin_dt)<br>when entry_dt<begin_dt and end_dt>=leave_dt and  leave_dt is not null then datediff(leave_dt,begin_dt)<br>end +1 as `days`,agent_amt/100 as `m`<br>from league_bill<br>where<br>store_sp_id!=1006<br>) tta<br>group by left(entry_dt,7);<br>        ",
    style: "fill: lightblue"
  },
  "id_2": {
    id: "id_2",
    label: "#meta124",
    description: "表 | ( SELECT begin_dt end_dt entry_dt leave_dt #meta125 + 1 AS `days` agent_amt / 100 AS `m` FROM league_bill WHERE store_sp_id! = 1006 )",
    style: "fill: blue"
  },
  "id_3": {
    id: "id_3",
    label: "league_bill",
    description: "表",
    style: "fill: blue"
  },
  "id_4": {
    id: "id_4",
    label: "agent_amt / 100",
    description: "字段",
    style: "fill: orange"
  },
  "id_5": {
    id: "id_5",
    label: "leave_dt",
    description: "字段",
    style: "fill: orange"
  },
  "id_6": {
    id: "id_6",
    label: "#meta113",
    description: "字段 | sum ( tta.m ) ",
    style: "fill: orange"
  },
  "id_7": {
    id: "id_7",
    label: "begin_dt",
    description: "字段",
    style: "fill: orange"
  },
  "id_8": {
    id: "id_8",
    label: "entry_dt",
    description: "字段",
    style: "fill: orange"
  },
  "id_9": {
    id: "id_9",
    label: "#meta117",
    description: "字段 | left ( entry_dt 7 ) ",
    style: "fill: orange"
  },
  "id_10": {
    id: "id_10",
    label: "#meta114",
    description: "字段 | sum ( tta.days ) ",
    style: "fill: orange"
  },
  "id_11": {
    id: "id_11",
    label: "#meta115",
    description: "字段 | sum ( tta.m ) / sum ( tta.days ) ",
    style: "fill: orange"
  },
  "id_12": {
    id: "id_12",
    label: "#meta125",
    description: "字段 | CASE WHEN entry_dt>end_dt THEN 0 WHEN entry_dt> = begin_dt AND end_dt< = leave_dt AND leave_dt IS NOT NULL THEN datediff ( end_dt entry_dt ) WHEN entry_dt> = begin_dt AND leave_dt IS NULL THEN datediff ( end_dt entry_dt ) WHEN entry_dt> = begin_dt AND end_dt> = leave_dt AND leave_dt IS NOT NULL THEN datediff ( end_dt entry_dt ) WHEN entry_dt<begin_dt AND end_dt< = leave_dt AND leave_dt IS NOT NULL THEN datediff ( end_dt begin_dt ) WHEN entry_dt<begin_dt AND leave_dt IS NULL THEN datediff ( end_dt begin_dt ) WHEN entry_dt<begin_dt AND end_dt> = leave_dt AND leave_dt IS NOT NULL THEN datediff ( leave_dt begin_dt ) END + 1 ",
    style: "fill: orange"
  },
  "id_ts": {
    id: "id_ts",
    label: "开始",
    description: "开始",
    style: "fill: red"
  },
  "id_14": {
    id: "id_14",
    label: "`m`",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_13": {
    id: "id_13",
    label: "end_dt",
    description: "字段",
    style: "fill: orange"
  },
  "id_16": {
    id: "id_16",
    label: "MONTH",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_15": {
    id: "id_15",
    label: "`days`",
    description: "字段别名",
    style: "fill: pink"
  }
  };

  // Add states to the graph, set labels, and style
  Object.keys(states).forEach(function (state) {
    var value = states[state];
    value.rx = value.ry = 5;
    g7.setNode(state, value);
  });

  // Set up the edges
  g7.setEdge( "id_ts", "id_1" , { label: "" });
g7.setEdge( "id_4", "id_14" , { label: "" });
g7.setEdge( "id_12", "id_15" , { label: "" });
g7.setEdge( "id_9", "id_16" , { label: "" });
g7.setEdge( "id_3", "id_4" , { label: "" });
g7.setEdge( "id_3", "id_5" , { label: "" });
g7.setEdge( "id_2", "id_6" , { label: "" });
g7.setEdge( "id_3", "id_7" , { label: "" });
g7.setEdge( "id_3", "id_8" , { label: "" });
g7.setEdge( "id_2", "id_9" , { label: "" });
g7.setEdge( "id_2", "id_10" , { label: "" });
g7.setEdge( "id_2", "id_11" , { label: "" });
g7.setEdge( "id_3", "id_12" , { label: "" });
g7.setEdge( "id_3", "id_13" , { label: "" });
g7.setEdge( "id_1", "id_2" , { label: "" });
g7.setEdge( "id_2", "id_3" , { label: "" });


  // Create the renderer
  var render = new dagreD3.render();

  // Set up an SVG group so that we can translate the final graph.
  var svg = d3.select("#svg7"),
    inner7 = svg.append("g");

  // Set up zoom support
  var zoom = d3.zoom()
    .on("zoom", function () {
      inner7.attr("transform", d3.event.transform);
    });
  svg.call(zoom);

  // Simple function to style the tooltip for the given node.
  var styleTooltip = function (name, description) {
    return "<p class='name'>" + name + "</p><p class='description' style='color:orange; width:100%; height:100%; display:inline-block' >" + description +"<br>" + "</p>";
  };

  // Run the renderer. This is what draws the final graph.
  render(inner7, g7);

  inner7.selectAll("g.node")
    .attr("title", function (v) { return styleTooltip(g7.node(v).label, g7.node(v).description) })
    .each(function (v) { $(this).tipsy({ gravity: "w", opacity: 1, html: true }); });

  inner7.selectAll("g.node").style("stroke-width", initialStrokeWidth);

  // function highlight nodes
  inner7.selectAll("g.node").on("mouseover", function (d) {
    inner7.selectAll("rect").style("stroke", highlight_color);
    g7.predecessors(d).forEach(function (nodeid) {
      my_node = inner7.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_upstream_color);
    })

    g7.successors(d).forEach(function (nodeid) {
      my_node = inner7.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_downstream_color);
    })
  });

  inner7.selectAll("g.node").on("mouseout", function (d) {
    inner7.selectAll("rect").style("stroke", null);
    g7.predecessors(d).forEach(function (nodeid) {
      my_node = inner7.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })

    g7.successors(d).forEach(function (nodeid) {
      my_node = inner7.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })
  });
  
  // Center the graph
  var initialScale = 0.75;
  svg.call(zoom.transform, d3.zoomIdentity.translate((svg.attr("width") - g7.graph().width * initialScale) / 2, 20).scale(initialScale));

  svg.attr('height', g7.graph().height * initialScale + 40);
</script>

<h3>朱雨测试SQL</h3>
<svg width=960 height=800 id="svg8"></svg>
<script>
  var highlight_color = "#000000";
  var upstream_color = "#0000FF";
  var downstream_color = "#0000FF"
  var fill_default_color = "rgb(240, 237, 228)"
  var fill_upstream_color = "orange"
  var fill_downstream_color = "orange"
  var initialStrokeWidth = '3px';
  
  // Create a new directed graph
  var g8 = new dagreD3.graphlib.Graph().setGraph({});

  // States and transitions from RFC 793
  var states = {
    "id_1": {
    id: "id_1",
    label: "SQL",
    description: "<br>        select a.mgmt_city_name as 区域, a.league_name as 门店名称, a.enroll_cnt as 预签到数, a.broker_cnt as 经纪人数, a.avg_cnt as 人均, a.row_num as 排名 from (<br>select x.*, (@row_num:=@row_num+1) as row_num from<br>(<br>SELECT c.mgmt_city_name, c.league_id, c.league_name, count(a.broker_enroll_id) as enroll_cnt, c.cnt as broker_cnt, count(a.broker_enroll_id)/c.cnt as avg_cnt<br>from (<br>	select d.league_id, count(distinct b.user_id) as cnt, d.mgmt_city_name, d.league_name<br>	from league_broker  a, league_store_broker  b, user  c, league_store  d<br>	where a.broker_id=b.broker_id and b.user_id=c.user_id and c.trgt_id=d.sp_id<br>	and a.entry_status=0 and a.is_deleted=0 and b.is_enabled=1 and b.is_deleted=0 and c.is_deleted=0 and c.is_enabled=1 and d.is_deleted=0<br>    and d.league_id in (1146,1128,1137,1138,1142,1144,1093,1101,1121,1125,1143,1145,1083,1129,1107,1102,1085,1136,1139,1065,1068,1090,1054,1091,1002,1045)<br>	group by league_store_id, d.mgmt_city_name, d.league_name<br>) c left join broker_enroll  a on<br>a.is_deleted = 0 and a.enroll_dt = DATE_ADD(current_date, INTERVAL 1 DAY) and a.created_tm >= CURRENT_DATE and a.store_league_id=c.league_id<br>GROUP BY c.mgmt_city_name, c.league_name<br>order by avg_cnt desc<br>) x, (select (@row_num :=0) ) y<br>) a<br>order by find_in_set(a.league_id, '1146,1128,1137,1138,1142,1144,1093,1101,1121,1125,1143,1145,1083,1129,1107,1102,1085,1136,1139,1065,1068,1090,1054,1091,1002,1045');<br>        ",
    style: "fill: lightblue"
  },
  "id_2": {
    id: "id_2",
    label: "#meta137",
    description: "表 | ( SELECT x.* #meta127 AS row_num FROM #meta134 x #meta136 y )",
    style: "fill: blue"
  },
  "id_3": {
    id: "id_3",
    label: "#meta134",
    description: "表 | ( SELECT c.mgmt_city_name c.league_id c.league_name count #meta128 AS enroll_cnt c.cnt AS broker_cnt count #meta129 / c.cnt AS avg_cnt FROM #meta132 c JOIN broker_enroll a ON a.is_deleted = 0 AND a.enroll_dt = DATE_ADD #meta133 AND a.created_tm > = CURRENT_DATE AND a.store_league_id = c.league_id GROUP BY c.mgmt_city_name c.league_name ORDER BY avg_cnt DESC )",
    style: "fill: blue"
  },
  "id_4": {
    id: "id_4",
    label: "#meta136",
    description: "表 | ( SELECT #meta135 )",
    style: "fill: blue"
  },
  "id_5": {
    id: "id_5",
    label: "#meta132",
    description: "表 | ( SELECT d.league_id count #meta130 AS cnt d.mgmt_city_name d.league_name FROM league_broker a league_store_broker b USER c league_store d WHERE a.broker_id = b.broker_id AND b.user_id = c.user_id AND c.trgt_id = d.sp_id AND a.entry_status = 0 AND a.is_deleted = 0 AND b.is_enabled = 1 AND b.is_deleted = 0 AND c.is_deleted = 0 AND c.is_enabled = 1 AND d.is_deleted = 0 AND d.league_id IN #meta131 GROUP BY league_store_id d.mgmt_city_name d.league_name )",
    style: "fill: blue"
  },
  "id_6": {
    id: "id_6",
    label: "broker_enroll",
    description: "表",
    style: "fill: blue"
  },
  "id_7": {
    id: "id_7",
    label: "league_broker",
    description: "表",
    style: "fill: blue"
  },
  "id_8": {
    id: "id_8",
    label: "league_store_broker",
    description: "表",
    style: "fill: blue"
  },
  "id_9": {
    id: "id_9",
    label: "USER",
    description: "表",
    style: "fill: blue"
  },
  "id_10": {
    id: "id_10",
    label: "league_store",
    description: "表",
    style: "fill: blue"
  },
  "id_11": {
    id: "id_11",
    label: "mgmt_city_name",
    description: "字段",
    style: "fill: orange"
  },
  "id_12": {
    id: "id_12",
    label: "league_id",
    description: "字段",
    style: "fill: orange"
  },
  "id_13": {
    id: "id_13",
    label: "*",
    description: "字段",
    style: "fill: orange"
  },
  "id_14": {
    id: "id_14",
    label: "league_name",
    description: "字段",
    style: "fill: orange"
  },
  "id_15": {
    id: "id_15",
    label: "#meta129",
    description: "字段 | count ( a.broker_enroll_id ) / c.cnt ",
    style: "fill: orange"
  },
  "id_16": {
    id: "id_16",
    label: "#meta128",
    description: "字段 | count ( a.broker_enroll_id ) ",
    style: "fill: orange"
  },
  "id_17": {
    id: "id_17",
    label: "#meta127",
    description: "字段 | ( @row_num := @row_num + 1 ) ",
    style: "fill: orange"
  },
  "id_18": {
    id: "id_18",
    label: "#meta135",
    description: "字段 | ( @row_num := 0 ) ",
    style: "fill: orange"
  },
  "id_19": {
    id: "id_19",
    label: "#meta130",
    description: "字段 | count ( b.user_id ) ",
    style: "fill: orange"
  },
  "id_20": {
    id: "id_20",
    label: "区域",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_21": {
    id: "id_21",
    label: "排名",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_22": {
    id: "id_22",
    label: "人均",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_23": {
    id: "id_23",
    label: "broker_cnt",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_24": {
    id: "id_24",
    label: "经纪人数",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_25": {
    id: "id_25",
    label: "门店名称",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_26": {
    id: "id_26",
    label: "avg_cnt",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_27": {
    id: "id_27",
    label: "enroll_cnt",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_28": {
    id: "id_28",
    label: "row_num",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_29": {
    id: "id_29",
    label: "cnt",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_30": {
    id: "id_30",
    label: "预签到数",
    description: "字段别名",
    style: "fill: pink"
  },
  "id_ts": {
    id: "id_ts",
    label: "开始",
    description: "开始",
    style: "fill: red"
  }
  };

  // Add states to the graph, set labels, and style
  Object.keys(states).forEach(function (state) {
    var value = states[state];
    value.rx = value.ry = 5;
    g8.setNode(state, value);
  });

  // Set up the edges
  g8.setEdge( "id_ts", "id_1" , { label: "" });
g8.setEdge( "id_11", "id_20" , { label: "" });
g8.setEdge( "id_28", "id_21" , { label: "" });
g8.setEdge( "id_26", "id_22" , { label: "" });
g8.setEdge( "id_29", "id_23" , { label: "" });
g8.setEdge( "id_23", "id_24" , { label: "" });
g8.setEdge( "id_14", "id_25" , { label: "" });
g8.setEdge( "id_15", "id_26" , { label: "" });
g8.setEdge( "id_16", "id_27" , { label: "" });
g8.setEdge( "id_17", "id_28" , { label: "" });
g8.setEdge( "id_19", "id_29" , { label: "" });
g8.setEdge( "id_27", "id_30" , { label: "" });
g8.setEdge( "id_10", "id_11" , { label: "" });
g8.setEdge( "id_10", "id_12" , { label: "" });
g8.setEdge( "id_3", "id_13" , { label: "" });
g8.setEdge( "id_10", "id_14" , { label: "" });
g8.setEdge( "id_3", "id_15" , { label: "" });
g8.setEdge( "id_3", "id_16" , { label: "" });
g8.setEdge( "id_2", "id_17" , { label: "" });
g8.setEdge( "id_4", "id_18" , { label: "" });
g8.setEdge( "id_5", "id_19" , { label: "" });
g8.setEdge( "id_5", "id_7" , { label: "" });
g8.setEdge( "id_5", "id_8" , { label: "" });
g8.setEdge( "id_3", "id_6" , { label: "" });
g8.setEdge( "id_5", "id_9" , { label: "" });
g8.setEdge( "id_2", "id_3" , { label: "" });
g8.setEdge( "id_5", "id_10" , { label: "" });
g8.setEdge( "id_2", "id_4" , { label: "" });
g8.setEdge( "id_1", "id_2" , { label: "" });
g8.setEdge( "id_3", "id_5" , { label: "" });


  // Create the renderer
  var render = new dagreD3.render();

  // Set up an SVG group so that we can translate the final graph.
  var svg = d3.select("#svg8"),
    inner8 = svg.append("g");

  // Set up zoom support
  var zoom = d3.zoom()
    .on("zoom", function () {
      inner8.attr("transform", d3.event.transform);
    });
  svg.call(zoom);

  // Simple function to style the tooltip for the given node.
  var styleTooltip = function (name, description) {
    return "<p class='name'>" + name + "</p><p class='description' style='color:orange; width:100%; height:100%; display:inline-block' >" + description +"<br>" + "</p>";
  };

  // Run the renderer. This is what draws the final graph.
  render(inner8, g8);

  inner8.selectAll("g.node")
    .attr("title", function (v) { return styleTooltip(g8.node(v).label, g8.node(v).description) })
    .each(function (v) { $(this).tipsy({ gravity: "w", opacity: 1, html: true }); });

  inner8.selectAll("g.node").style("stroke-width", initialStrokeWidth);

  // function highlight nodes
  inner8.selectAll("g.node").on("mouseover", function (d) {
    inner8.selectAll("rect").style("stroke", highlight_color);
    g8.predecessors(d).forEach(function (nodeid) {
      my_node = inner8.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_upstream_color);
    })

    g8.successors(d).forEach(function (nodeid) {
      my_node = inner8.select('#' + nodeid + ' rect');
      my_node.style("stroke", fill_downstream_color);
    })
  });

  inner8.selectAll("g.node").on("mouseout", function (d) {
    inner8.selectAll("rect").style("stroke", null);
    g8.predecessors(d).forEach(function (nodeid) {
      my_node = inner8.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })

    g8.successors(d).forEach(function (nodeid) {
      my_node = inner8.select('#' + nodeid + ' rect');
      my_node.style("stroke", null);
    })
  });
  
  // Center the graph
  var initialScale = 0.75;
  svg.call(zoom.transform, d3.zoomIdentity.translate((svg.attr("width") - g8.graph().width * initialScale) / 2, 20).scale(initialScale));

  svg.attr('height', g8.graph().height * initialScale + 40);
</script>


